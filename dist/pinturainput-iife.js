/*!
* Pintura Input v9.0.1 
* (c) 2018-2023 PQINA Inc. - All Rights Reserved
* License: https://pqina.nl/pintura/license/
*/
/* eslint-disable */
(function(){"use strict";const S=(e,s,n=[])=>{const t=document.createElement(e),i=Object.getOwnPropertyDescriptors(t.__proto__);for(const r in s)r==="style"?t.style.cssText=s[r]:i[r]&&i[r].set||/textContent|innerHTML/.test(r)||typeof s[r]=="function"?t[r]=s[r]:t.setAttribute(r,s[r]);return n.forEach(r=>t.appendChild(r)),t},x=e=>typeof e=="string";let b=null;const D=()=>(b===null&&(b=typeof window<"u"&&typeof window.document<"u"),b),M=e=>e.charAt(0).toLowerCase()+e.slice(1),H=e=>e.charAt(0).toUpperCase()+e.slice(1),N=e=>M(e.split("-").map(H).join("")),q=e=>typeof e=="object",E=(e,s={},n="",t="")=>Object.keys(s).filter(i=>!q(s[i])).reduce((i,r)=>i.replace(new RegExp(n+r+t),s[r]),e),U=e=>document.createElement(e).constructor!==HTMLElement,B=e=>e instanceof Blob,V=e=>/^image/.test(e.type),W=async e=>new Promise(s=>{if(e.kind==="file")return s(e.getAsFile());e.getAsString(s)}),G=e=>new Promise((s,n)=>{const{items:t}=e.dataTransfer;if(!t)return s([]);Promise.all(Array.from(t).map(W)).then(i=>{s(i.filter(r=>B(r)&&V(r)||/^http/.test(r)))}).catch(n)}),K=(e,s={})=>{const n=i=>{i.preventDefault()},t=async i=>{i.preventDefault(),i.stopPropagation();try{const r=await G(i);e.dispatchEvent(new CustomEvent("dropfiles",{detail:{event:i,resources:r},...s}))}catch{}};return e.addEventListener("drop",t),e.addEventListener("dragover",n),{destroy(){e.removeEventListener("drop",t),e.removeEventListener("dragover",n)}}},C="pintura-input",$="PinturaInput",J=`<output data-process style="display:flex;align-items:center;pointer-events:none;">
    <img src="{url}" alt="" style="object-fit:cover;width:auto;height:1.5em;margin-right:.5em;"/>
    <span>{{success}}</span>
    <button data-remove style="pointer-events:all;margin-left:.5em;" aria-label="Reset">{{reset}}</button>
</output>`,Y=`<div data-load style="display:flex;align-items:center;pointer-events:none;">
    <img src="{{url}}" alt="" style="object-fit:cover;width:auto;height:1.5em;margin-right:.5em;"/>
    <button data-remove style="pointer-events:all;margin-left:.5em;" aria-label="Reset">{{reset}}</button>
</output>`,z=["accept","capture"],Q=(e,s)=>new Promise((n,t)=>{const{store:i,editor:r,eventTarget:f,imageState:m}=s,{openDefaultEditor:c,dispatchEditorEvents:o}=window.pintura,a={};r.imageReader&&(a.imageReader={...r.imageReader}),(r.imageWriter||i)&&(a.imageWriter={store:(x(i),i),...r.imageWriter});const l=c({...a,...X(r,["id","name","store","imageWriter","imageReader"]),src:e,imageState:m}),ae=o(l,f);let k=!1;l.on("loadabort",()=>{l.close(),k=!0}),l.on("loaderror",t),l.on("processerror",t),l.on("close",()=>{ae.forEach(ce=>ce()),k?t():n(void 0)}),l.on("process",n)}),u=(e,s)=>e.getAttribute(s),X=(e,s)=>Object.keys(e).filter(n=>!s.includes(n)).reduce((n,t)=>({...n,[t]:e[t]}),{}),h=e=>{e.value="",/safari/i.test(navigator.userAgent)||(e.type="",e.type="file"),delete e._files},R=(e,s)=>{try{const n=new DataTransfer;n.items.add(s),e.files=n.files}catch{e._files=[s]}},Z=e=>{if(!e||!e.matches('input[type="file"]'))return;const s=e,n=s.files[0]||(s._files||[])[0];if(n&&/image/.test(n.type))return n},ee=(e,s="")=>N(e.replace(new RegExp("^"+s,"g"),"")),te=e=>{if(e==="true"||e==="false")return e==="true";if(!isNaN(e))return parseFloat(e);if(/[0-9]+\/[0-9]+/.test(e)){const[s,n]=e.split("/").map(t=>t.trim()).map(parseFloat);return s/n}if(/^\{|\[/.test(e))try{return JSON.parse(e)}catch{}return e},se=e=>Object.values(e).reduce((s,n)=>{const t=ee(n.name);return s[t]=te(n.value),s},{}),ne=(e,s,n)=>{const t=Object.values(n).filter(r=>/^post/.test(r.name)).map(r=>[r.name.replace(/^post-/,""),r.value]);return{url:s||"",dataset:r=>[...t,[e,r.dest,r.dest.name]]}},I=(e,s)=>(Array.from(e.attributes).filter(({value:t})=>t.length&&t.includes("{")).forEach(({name:t,value:i})=>e.setAttribute(t,E(i,s,"{","}"))),e.childNodes.forEach(t=>{t.nodeType===1&&(t=I(t,s)),t.nodeType===3&&(t.textContent=E(t.textContent,s,"{","}"))}),e),T=(e,s)=>e&&e.content.querySelector(`[data-${s}]`),A=e=>e.querySelector("template"),O=e=>{const s=A(e),n=T(s,"empty"),t=T(s,"load"),i=T(s,"process");return{empty:n,load:t,process:i}},g=(e,s)=>!!O(e)[s],re=(e,s)=>e.querySelector(`[data-${s}]`),p=(e,s,n)=>{const t=O(e);if(Object.keys(t).map(r=>re(e,r)).filter(Boolean).forEach(r=>r.remove()),!t[s])return!1;let i=t[s].cloneNode(!0);return n&&(i=I(i,n)),e.appendChild(i),e.querySelector("[data-drop]")&&K(i,{bubbles:!0}),!0},d=e=>e.querySelector('input[type="file"]'),y=e=>e.querySelector('input[type="hidden"]'),w=e=>{const s=u(e,"src");if(s!=null)return s},P=e=>e.currentState,v=(e,s)=>{e.currentState=s},F=e=>u(e,"store"),j=(e,s,n)=>{const t=A(e)||document.createElement("template");t.innerHTML=t.innerHTML+E(s,n,"{{","}}"),t.parentNode||e.appendChild(t)},ie=(e,s,n)=>{if(!s)return;const t=d(e);if(!t)return;const i={...window[$],...window[e.id],...se(e.attributes)},r=(o,a)=>{t.hidden=!0;const l=y(e);l.value=a.responseText,p(e,"process",{response:a.responseText,filename:o.name,url:URL.createObjectURL(o)})},f=o=>{p(e,"process",{filename:o.name,url:URL.createObjectURL(o)})&&(d(e).hidden=!0)},m=o=>{if(!o){v(globalThis,void 0),h(t);return}const{dest:a,store:l}=o;v(e,o),l?r(a,l):(R(t,a),f(a))},c=()=>{h(t)};Q(s,{editor:i,eventTarget:e,imageState:n,store:i.store&&ne(y(e).name,i.store,e.attributes)}).then(m).catch(c)};function L(){const e=F(this),s=w(this),n={success:u(this,"input-store-success")||'"{filename}" uploaded successfully',reset:u(this,"input-button-reset")||"&times;",url:s};s&&!g(this,"load")&&j(this,Y,n),e&&!g(this,"process")&&j(this,J,n);let t=d(this),i=y(this);const r=t&&t.name||u(this,"name")||"image";t||(t=S("input",{type:"file"}),z.forEach(c=>{const o=u(this,c);o!==null&&t.setAttribute(c,o)}),this.removeAttribute("name"),this.append(t)),e?(t.removeAttribute("name"),i||(i=S("input",{type:"hidden",name:r}),this.append(i))):t.name=r,!s&&g(this,"empty")&&(p(this,"empty"),t.hidden=!0),s&&g(this,"load")&&(p(this,"load"),t.hidden=!0),(!t.accept||!/image/.test(t.accept))&&(t.accept="image/*"),t.removeAttribute("multiple"),this.handleEvent=c=>{const{type:o,target:a}=c;if(o==="change"&&a===t)return this.edit();if(o==="click")return f(c);if(o==="dropfiles")return m(c)};const f=c=>{const{target:o}=c,a=["reset","remove","browse","edit"].find(l=>o.dataset[l]==="");a&&this[a]()},m=c=>{c.stopPropagation();const{detail:o}=c,a=o.resources[0];a&&(R(t,a),this.edit())};t.addEventListener("change",this),this.addEventListener("click",this),this.addEventListener("dropfiles",this)}function oe(){this.removeEventListener("click",this),this.removeEventListener("dropfiles",this)}const _=D()&&class extends HTMLElement{constructor(){super(...arguments),this.currentState=void 0}connectedCallback(){if(this.innerHTML)return L.apply(this);let e;const s=new MutationObserver(()=>{e!==null&&(clearTimeout(e),L.apply(this),s.disconnect())});s.observe(this,{childList:!0}),e=setTimeout(()=>{e=null,L.apply(this)},0)}disconnectedCallback(){oe.apply(this)}browse(){this.querySelector('input[type="file"]').click()}reset(){if(v(this,void 0),!w(this))return this.remove();h(d(this)),p(this,"load")}remove(){const e=d(this);h(e),v(this,void 0),F(this)&&(y(this).value=""),p(this,"empty")||(e.hidden=!1)}edit(){var n,t;const e=d(this);if(!e)return;const s=((n=P(this))==null?void 0:n.src)||Z(e)||w(this);ie(this,s,(t=P(this))==null?void 0:t.imageState)}};_&&!U(C)&&customElements.define(C,_)})();
