/*!
* Pintura Input v9.0.2 
* (c) 2018-2023 PQINA Inc. - All Rights Reserved
* License: https://pqina.nl/pintura/license/
*/
/* eslint-disable */
(function(){"use strict";const L=(e,t,n=[])=>{const s=document.createElement(e),i=Object.getOwnPropertyDescriptors(s.__proto__);for(const r in t)r==="style"?s.style.cssText=t[r]:i[r]&&i[r].set||/textContent|innerHTML/.test(r)||typeof t[r]=="function"?s[r]=t[r]:s.setAttribute(r,t[r]);return n.forEach(r=>s.appendChild(r)),s},D=e=>typeof e=="string";let b=null;const M=()=>(b===null&&(b=typeof window<"u"&&typeof window.document<"u"),b),H=e=>e.charAt(0).toLowerCase()+e.slice(1),N=e=>e.charAt(0).toUpperCase()+e.slice(1),q=e=>H(e.split("-").map(N).join("")),U=e=>typeof e=="object",E=(e,t={},n="",s="")=>Object.keys(t).filter(i=>!U(t[i])).reduce((i,r)=>i.replace(new RegExp(n+r+s),t[r]),e),B=e=>document.createElement(e).constructor!==HTMLElement,V=e=>e instanceof Blob,W=e=>/^image/.test(e.type),G=async e=>new Promise(t=>{if(e.kind==="file")return t(e.getAsFile());e.getAsString(t)}),K=e=>new Promise((t,n)=>{const{items:s}=e.dataTransfer;if(!s)return t([]);Promise.all(Array.from(s).map(G)).then(i=>{t(i.filter(r=>V(r)&&W(r)||/^http/.test(r)))}).catch(n)}),$=(e,t={})=>{const n=i=>{i.preventDefault()},s=async i=>{i.preventDefault(),i.stopPropagation();try{const r=await K(i);e.dispatchEvent(new CustomEvent("dropfiles",{detail:{event:i,resources:r},...t}))}catch{}};return e.addEventListener("drop",s),e.addEventListener("dragover",n),{destroy(){e.removeEventListener("drop",s),e.removeEventListener("dragover",n)}}},C="pintura-input",J="PinturaInput",Y=`<output data-process style="display:flex;align-items:center;pointer-events:none;">
    <img src="{url}" alt="" style="object-fit:cover;width:auto;height:1.5em;margin-right:.5em;"/>
    <span>{{success}}</span>
    <button data-remove style="pointer-events:all;margin-left:.5em;" aria-label="Reset">{{reset}}</button>
</output>`,z=`<div data-load style="display:flex;align-items:center;pointer-events:none;">
    <img src="{{url}}" alt="" style="object-fit:cover;width:auto;height:1.5em;margin-right:.5em;"/>
    <button data-remove style="pointer-events:all;margin-left:.5em;" aria-label="Reset">{{reset}}</button>
</output>`,Q=["accept","capture"],X=(e,t)=>new Promise((n,s)=>{const{store:i,editor:r,eventTarget:m,imageState:p}=t,{openDefaultEditor:o,dispatchEditorEvents:a}=window.pintura,c={};r.imageReader&&(c.imageReader={...r.imageReader}),(r.imageWriter||i)&&(c.imageWriter={store:(D(i),i),...r.imageWriter});const l=o({...c,...Z(r,["id","name","store","imageWriter","imageReader"]),src:e,imageState:p}),ue=a(l,m);let x=!1;l.on("loadabort",()=>{l.close(),x=!0}),l.on("loaderror",s),l.on("processerror",s),l.on("close",()=>{ue.forEach(pe=>pe()),x?s():n(void 0)}),l.on("process",n)}),d=(e,t)=>e.getAttribute(t),Z=(e,t)=>Object.keys(e).filter(n=>!t.includes(n)).reduce((n,s)=>({...n,[s]:e[s]}),{}),h=e=>{e.value="",/safari/i.test(navigator.userAgent)||(e.type="",e.type="file"),delete e._files},R=(e,t)=>{try{const n=new DataTransfer;n.items.add(t),e.files=n.files}catch{e._files=[t]}},ee=e=>{if(!e||!e.matches('input[type="file"]'))return;const t=e,n=t.files[0]||(t._files||[])[0];if(n&&/image/.test(n.type))return n},te=(e,t="")=>q(e.replace(new RegExp("^"+t,"g"),"")),se=e=>{if(e==="true"||e==="false")return e==="true";if(!isNaN(e))return parseFloat(e);if(/[0-9]+\/[0-9]+/.test(e)){const[t,n]=e.split("/").map(s=>s.trim()).map(parseFloat);return t/n}if(/^\{|\[/.test(e))try{return JSON.parse(e)}catch{}return e},ne=e=>Object.values(e).reduce((t,n)=>{const s=te(n.name);return t[s]=se(n.value),t},{}),re=(e,t,n)=>{const s=Object.values(n).filter(r=>/^post/.test(r.name)).map(r=>[r.name.replace(/^post-/,""),r.value]);return{url:t||"",dataset:r=>[...s,[e,r.dest,r.dest.name]]}},I=(e,t)=>(Array.from(e.attributes).filter(({value:s})=>s.length&&s.includes("{")).forEach(({name:s,value:i})=>e.setAttribute(s,E(i,t,"{","}"))),e.childNodes.forEach(s=>{s.nodeType===1&&(s=I(s,t)),s.nodeType===3&&(s.textContent=E(s.textContent,t,"{","}"))}),e),T=(e,t)=>e&&e.content.querySelector(`[data-${t}]`),A=e=>e.querySelector("template"),O=e=>{const t=A(e),n=T(t,"empty"),s=T(t,"load"),i=T(t,"process");return{empty:n,load:s,process:i}},g=(e,t)=>!!O(e)[t],ie=(e,t)=>e.querySelector(`[data-${t}]`),f=(e,t,n)=>{const s=O(e);if(Object.keys(s).map(r=>ie(e,r)).filter(Boolean).forEach(r=>r.remove()),!s[t])return!1;let i=s[t].cloneNode(!0);return n&&(i=I(i,n)),e.appendChild(i),e.querySelector("[data-drop]")&&$(i,{bubbles:!0}),!0},u=e=>e.querySelector('input[type="file"]'),y=e=>e.querySelector('input[type="hidden"]'),w=e=>{const t=d(e,"src");if(t!=null)return t},P=e=>e.currentState,v=(e,t)=>{e.currentState=t},F=e=>d(e,"store"),j=(e,t,n)=>{const s=A(e)||document.createElement("template");s.innerHTML=s.innerHTML+E(t,n,"{{","}}"),s.parentNode||e.appendChild(s)},oe=(e,t,n)=>{const s=u(e);s.hidden=!0;const i=y(e);i.value=n.responseText,f(e,"process",{response:n.responseText,filename:t.name,url:URL.createObjectURL(t)})},ae=(e,t)=>{f(e,"process",{filename:t.name,url:URL.createObjectURL(t)})&&(u(e).hidden=!0)},_=(e,t)=>{const{dest:n,store:s}=t,i=u(e);s?oe(e,n,s):(R(i,n),ae(e,n))},ce=(e,t,n)=>{if(!t)return;const s=u(e);if(!s)return;const i={...window[J],...window[e.id],...ne(e.attributes)},r=p=>{if(!p){v(globalThis,void 0),h(s);return}v(e,p),_(e,p)},m=()=>{h(s)};X(t,{editor:i,eventTarget:e,imageState:n,store:i.store&&re(y(e).name,i.store,e.attributes)}).then(r).catch(m)};function S(){const e=F(this),t=w(this),n={success:d(this,"input-store-success")||'"{filename}" uploaded successfully',reset:d(this,"input-button-reset")||"&times;",url:t};t&&!g(this,"load")&&j(this,z,n),e&&!g(this,"process")&&j(this,Y,n);let s=u(this),i=y(this);const r=s&&s.name||d(this,"name")||"image";s||(s=L("input",{type:"file"}),Q.forEach(o=>{const a=d(this,o);a!==null&&s.setAttribute(o,a)}),this.removeAttribute("name"),this.append(s)),e?(s.removeAttribute("name"),i||(i=L("input",{type:"hidden",name:r}),this.append(i))):s.name=r,!t&&g(this,"empty")&&(f(this,"empty"),s.hidden=!0),t&&g(this,"load")&&(f(this,"load"),s.hidden=!0),(!s.accept||!/image/.test(s.accept))&&(s.accept="image/*"),s.removeAttribute("multiple"),this.handleEvent=o=>{const{type:a,target:c}=o;if(a==="change"&&c===s)return this.edit();if(a==="click")return m(o);if(a==="dropfiles")return p(o)};const m=o=>{const{target:a}=o,c=["reset","remove","browse","edit"].find(l=>a.dataset[l]==="");c&&this[c]()},p=o=>{o.stopPropagation();const{detail:a}=o,c=a.resources[0];c&&(R(s,c),this.edit())};s.addEventListener("change",this),this.addEventListener("click",this),this.addEventListener("dropfiles",this),this.currentState&&_(this,this.currentState)}function le(){this.removeEventListener("click",this),this.removeEventListener("dropfiles",this)}const k=M()&&class extends HTMLElement{constructor(){super(...arguments),this.currentState=void 0}connectedCallback(){if(this.innerHTML)return S.apply(this);let e;const t=new MutationObserver(()=>{e!==null&&(clearTimeout(e),S.apply(this),t.disconnect())});t.observe(this,{childList:!0}),e=setTimeout(()=>{e=null,S.apply(this)},0)}disconnectedCallback(){le.apply(this)}browse(){this.querySelector('input[type="file"]').click()}reset(){if(v(this,void 0),!w(this))return this.remove();h(u(this)),f(this,"load")}remove(){const e=u(this);h(e),v(this,void 0),F(this)&&(y(this).value=""),f(this,"empty")||(e.hidden=!1)}edit(){var n,s;const e=u(this);if(!e)return;const t=((n=P(this))==null?void 0:n.src)||ee(e)||w(this);ce(this,t,(s=P(this))==null?void 0:s.imageState)}};k&&!B(C)&&customElements.define(C,k)})();
